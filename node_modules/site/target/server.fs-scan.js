"use strict";Object.defineProperty(exports,"__esModule",{value:!0});arguments;var t=require("./shared.manifest"),e=n(require("fs")),r=n(require("path")),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(require("./server.common-responses"));function n(t){return t&&t.__esModule?t:{default:t}}var i,a,o,u,l,c,d,h,p,m,f=function(t){return null!=t},g=function(t){var e=t.call(this);return new Promise(function(t,r){!function s(n,i){try{var a=e[n](i),o=a.value}catch(t){return void r(t)}a.done?t(o):Promise.resolve(o).then(function(t){s("next",t)},function(t){s("throw",t)})}("next")})};exports.default=(o=Symbol(),u=Symbol(),l=Symbol(),c=Symbol(),d=Symbol(),h=Symbol(),p=Symbol(),(m=class{constructor(t,e,r,s,n){((t,e,r,s,n)=>(()=>{this.path=t,this.url=e,this.request=r,this.response=s,this.context=n})())(t,e,r,s,n)}process(){return(()=>{return(()=>this.path.endsWith("/")?(()=>this[u]())():(()=>this[l]())())()})()}[c](e){return(e=>(()=>(0,t.assert)(-1!==e.search(new RegExp("^public($|/|\\\\)"))))())(e)}[d](t){return(t=>(()=>{var e;return void 0===(e=this.constructor.mimeTable[r.default.extname(t)])||null===e?this.constructor.mimeTable._:e})())(t)}[u](){return(()=>{return(()=>{var n,i,a;return n=this[h](),i=0,(a=(()=>{return(()=>{var u,l,h,p,m,g;return u=r.default.join("public",this.path,this.constructor.defaultFiles[i]),this[c](u),l=this[d](u),h=u+".compressed-705357537593286848.gz",p=n&&f(this.constructor[o][h]),m=e.default.createReadStream(p?(()=>h)():(()=>u)()),g=0,m.on("data",t=>(()=>(1===(g+=1)&&(()=>(this.response.statusCode=200,this.response.setHeader("Content-Type",l),p?(()=>this.response.setHeader("Content-Encoding","gzip"))():void 0))(),this.response.write(t)))()),m.on("end",()=>{return(()=>this.response.end())()}),m.on("error",()=>{return(()=>(()=>{try{return(()=>(i+=1)<this.constructor.defaultFiles.length?(()=>a())():(()=>(0,t.fail)())())()}catch(t){return(()=>s.send500(this.response))()}})())()})})()}))()})()})()}[l](){return(()=>{return g.call(this,function*(){var n,i,a,u,l,m,v,y,x,b;return n=this[h](),i=r.default.join("public",this.path),this[c](i),a=this[d](i),u=i+".compressed-705357537593286848.gz",l=n&&f(this.constructor[o][u]),m=l?yield g.call(this,function*(){return u}):yield g.call(this,function*(){return i}),v=0,yield g.call(this,function*(){try{return yield g.call(this,function*(){return y=(yield e.default.statAsync(m)).size,x=this[p](y,l),(b=f(x)?yield g.call(this,function*(){return e.default.createReadStream(m,{start:x.start,end:x.end})}):yield g.call(this,function*(){return e.default.createReadStream(m)})).on("data",t=>(()=>(1===(v+=1)&&(()=>(f(x)?(()=>(this.response.statusCode=206,this.response.setHeader("Content-Length",(x.end-x.start+1).toString()),this.response.setHeader("Content-Range","bytes "+x.start+"-"+x.end+"/"+y)))():(()=>(this.response.statusCode=200,this.response.setHeader("Content-Length",y.toString())))(),this.response.setHeader("Content-Type",a),l?(()=>this.response.setHeader("Content-Encoding","gzip"))():(()=>this.response.setHeader("Accept-Ranges","bytes"))()))(),this.response.write(t)))()),b.on("end",()=>{return(()=>this.response.end())()}),b.on("error",e=>(()=>(()=>{try{return(()=>"EISDIR"===e.code?(()=>s.send302(this.url.pathname+"/",this.response))():(()=>(0,t.fail)())())()}catch(t){return(()=>s.send500(this.response))()}})())())})}catch(t){return yield g.call(this,function*(){return s.send500(this.response)})}})})})()}[h](){return(()=>{return(()=>!(!f(this.request.headers["accept-encoding"])||!this.request.headers["accept-encoding"].split(",").map(t=>(()=>{var e;return{tag:(e=t.split(";"))[0].trim(),q:f(e[1])?(()=>parseFloat(e[1].split("=")[1]))():1}})()).some(t=>(()=>"gzip"===t.tag&&0!==t.q)())))()})()}[p](t,e){return((t,e)=>(()=>{var r;return e?null:(()=>(r=this.context.request.range,t>0&&f(r)?(()=>f(r.start)?(()=>r.start<t?(()=>f(r.end)?(()=>({start:r.start,end:Math.min(r.end,t-1)}))():(()=>({start:r.start,end:t-1}))())():null)():(()=>({start:Math.max(t-r.suffixByteCount,0),end:t-1}))())():null))()})())(t,e)}}).defaultFiles=["default.html","default.htm","default.xhtml","index.html","index.htm","index.xhtml"],m.mimeTable={".aac":"audio/aac",".css":"text/css",".gif":"image/gif",".htm":"text/html",".html":"text/html",".ico":"image/x-icon",".jpeg":"image/jpeg",".jpg":"image/jpeg",".js":"application/javascript",".json":"application/json",".m4a":"audio/mp4",".m4v":"video/mp4",".mjs":"application/javascript",".mp3":"audio/mpeg",".mp4":"video/mp4",".oga":"audio/ogg",".ogg":"audio/ogg",".ogv":"video/ogg",".pdf":"application/pdf",".png":"image/png",".svg":"image/svg+xml",".txt":"text/plain",".webm":"video/webm",".wma":"audio/x-ms-wma",".wmv":"video/x-ms-wmv",".woff":"application/font-woff",".xhtml":"application/xhtml+xml",".xml":"text/xml",".zip":"application/zip",_:"application/octet-stream"},m[o]=(i={},a=(t=>(()=>e.default.readdirSync(t).forEach(s=>(()=>{var n,o;return n=r.default.join(t,s),(o=e.default.statSync(n)).isFile()&&n.endsWith(".compressed-705357537593286848.gz")&&(i[n]=!0),o.isDirectory()?(()=>a(n))():void 0})()))()),(()=>{try{(()=>a("public"))()}catch(t){}})(),i),m);